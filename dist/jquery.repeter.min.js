!function(e,t,i,n){"use strict";function l(t,i){this.element=t,this.template=null,this.items={},this.opt=e.extend(!0,{},a,i),this._name=o,this.init()}function s(t,i,n){console.log(t,i,n),n?t.addClass(n).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(i){e(t).remove()}):e(t,i.element).remove()}var o="repeter",a={addBtnSelector:".add",remBtnSelector:".remove",tmplSelector:".template",formSelector:"form",elements:{"class":"element",appendTo:null,animation:null,mirror:{selector:null,tmplSelector:null,animation:null}}};e.extend(l.prototype,{init:function(){var t=this;return this.template=e(this.element).find(this.opt.tmplSelector)[0],this._template=e(this.element).find(this.opt.elements.mirror.tmplSelector)[0],e(this.element).on("click",this.opt.addBtnSelector,function(){t.addItem()}).on("click",this.opt.remBtnSelector,function(){t.removeItem(this)}),this},addItem:function(){var t=this.template,i=this._template,n=e(this.element).find("."+this.opt.elements["class"]).length,l=e.extend({numElement:n},this.opt.tmplData instanceof Function?this.opt.tmplData():this.opt.tmplData||{}),s="SCRIPT"==t.nodeName?e(t).tmpl(l):e(t).clone().removeClass(this.opt.tmplSelector);console.log(this.opt.tmplData,l),this.items["item"+n]=e.tmplItem(s),s.addClass(this.opt.elements["class"]+" r-ele-"+n).data("r-ele",n);var o=this.opt.elements.appendTo||this.opt.elements.insertIn||this.opt.elements.mirror.selector;if(o){var a=null;if(this.opt.elements.mirror.selector)if(i){var r="SCRIPT"==i.nodeName?e(i).tmpl(l):e(i).clone().removeClass(this.opt.tmplSelector);a=r.addClass("r-ele-"+n).data("r-ele",n)}else a=s.clone().removeClass(this.opt.elements["class"]),a.find(".remove")[0].remove();e(o).append(a||s)}if(this.opt.elements.appendTo&&!this.opt.elements.mirror.selector||s.insertBefore(t),e.fn.formValidation||e.fn.validator){var m=e(this.element).closest(this.opt.formSelector);s.find("[disabled]").prop("disabled",!1),m.data("formValidation")&&s.find("input,textarea,select").filter(":visible").each(function(){m.formValidation("addField",this.name)})}return{parent:this.element,addedElement:s,removedElement:null}},removeItem:function(t){var t="number"==typeof t?e("r-ele-"+t,this.element):t,i=e(t).closest("."+this.opt.elements["class"],this.element),n=e(i).data("r-ele"),l=e(this.element).find("."+this.opt.elements["class"]).length,o=e(this.opt.elements.mirror.selector).find(".r-ele-"+n);(e.fn.formValidation||e.fn.validator)&&e(t).prev().find(":input:last-child").focus(),s(i,this,this.opt.elements.animation),o&&s(o,this,this.opt.elements.mirror.animation);for(var a=n;l-1>a;a++)this.items["item"+a]=this.items["item"+(a+1)],this.items["item"+a].data.numElement=a,this.items["item"+a].update(),e(this.items["item"+a].nodes).data("r-ele",a).addClass(this.opt.elements["class"]+" r-ele-"+a);if(o)for(var a=n;l>a;a++)e(".r-ele-"+a,this.opt.elements.mirror.selector).removeClass("r-ele-"+a).addClass("r-ele-"+(a-1));return delete this.items["item"+(l-1)],{parent:this,addedElement:null,removedElement:i}}}),e.fn[o]=function(t){var i=arguments;if(t===n||"object"==typeof t)return this.each(function(){e.data(this,"plugin_"+o)||e.data(this,"plugin_"+o,new l(this,t))});if("string"==typeof t&&"_"!==t[0]&&"init"!==t){var s;return this.each(function(){var n=e.data(this,"plugin_"+o);n instanceof l&&"function"==typeof n[t]&&(s=n[t].apply(n,Array.prototype.slice.call(i,1))),"destroy"===t&&e.data(this,"plugin_"+o,null)}),s!==n?s:this}}}(jQuery,window,document);
